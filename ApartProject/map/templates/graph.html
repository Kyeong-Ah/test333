<!DOCTYPE html>
<html>
<head>
	<style>
	/* font */
		* {
		 margin : 0; font-family: 'Noto Serif KR', serif;
		}
		body{
         padding-top: 40px 
      	}
	</style>
<meta charset="UTF-8">
<title>집 값 예측</title>
<script src='https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.8.0/chart.min.js'></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
<script src="http://code.jquery.com/jquery-latest.min.js"></script>

<header>
{% include 'head.html' %}
</header>

</head>
<body >
<div id='gu' style='display:None'>{{gu}}</div>
<div id='addr' style='display:None'>{{addr}}</div>
<br>
{{apt}} 의 <input type="month" id="year" /> 년 &nbsp;&nbsp;
<button onclick="pred()">입력</button> 후 집값 확인
<div class="pred"></div>
<br />

<div class="container">
	<div class="row">
		<div class="col-md-10">
			<canvas id = 'chart'>{{mean}}</canvas>
			<canvas id = 'chart2'></canvas>
			<div id='ymd' style='display:None'>{{ymd}}</div>

		</div>
	</div>
</div>
<script type="text/javascript">
let chart = document.getElementById('chart').getContext('2d');

var tdata = document.getElementById('chart').innerHTML;
var tdata = JSON.parse(tdata);


var ymd = document.getElementById('ymd').innerHTML;
var ymd = JSON.parse(ymd);

function graphs(tdata, ymd){
	
	let linechart = new Chart(chart, {
		type : 'line',
		data : {
			labels : ymd,
										  
			datasets : [{
				label : '월 평균 거래금액',
				backgroundColor : 'skyblue',
				borderWidth : 1,
				borderColor : 'black',
				data : tdata
	
			}]
		}
	})
}

graphs(tdata, ymd)

function pred(){
	let send_data = {};
	let year = document.getElementById("year").value;
	let gu = document.getElementById("gu").innerHTML;
	send_data['year'] = year;
	send_data['gu']= gu;
	send_data['addr']=document.getElementById("addr").innerHTML;
	send_data['mean']=document.getElementById("chart").innerHTML;
	send_data['ymd']=document.getElementById("ymd").innerHTML;
	
	console.log(send_data);
   	  
	$(".pred").empty();
	
	$.ajax({
		url: "pred",
	    type:"post",
	    data:send_data,
	    dataType:"json",
	    success:function(data){
	    	let chart = document.getElementById('chart2').getContext('2d');
			
			var tdata = send_data.mean+data.predict

			var ymd = send_data.ymd + data.ymd2
	
			console.log(typeof(send_data.ymd))
			console.log((send_data.ymd))
			console.log(typeof((data.ymd2)))
			console.log(((data.ymd2)))
			
			let linechart = new Chart(chart, {
				type : 'line',
     			data : {
     				labels :  data.ymd2,
     				
     				datasets : [{
     					label : '예측 값',
     					backgroundColor : 'yellow',
     					borderWidth : 1,
     					borderColor : 'orange',
     					data : data.predict
     				}]
     			}
     		})
	     },
	     error:function(){
	    	 alert('1~ 10년만 입력 가능!')
	     }
	});
}

</script>

<p>최근 10년 거래 데이터</p>

{% if datas %}
	{{datas | safe}}
{% endif %}

</body>
</html>